# Face Recognition and Clustering Application

This repository contains a Flask-based web application that allows users to upload images via file upload, URL, or Base64 string, and processes them to detect and analyze faces. The application uses [DeepFace](https://github.com/serengil/deepface) for face detection, facial attribute analysis, and embedding generation, which are then stored in a PostgreSQL database. Redis is used for queuing the images for processing.

## Features

- **Image Upload**: Users can upload images via file upload, URL, or Base64 string.
- **Face Detection and Analysis**: Extracts face embeddings and analyzes age, gender, race, and emotion using the [DeepFace](https://github.com/serengil/deepface) package.
- **Face Clustering**: Uses HDBSCAN for clustering similar faces.
- **Person Identification**: Identifies and stores unique individuals based on facial embeddings.
- **Face Bounding Box Visualization**: Displays images with detected face bounding boxes.

## Project Structure

- `app.py`: The main Flask application file. It handles routes for uploading images, viewing processed persons, and clustering.
- `worker.py`: A background worker that processes images, performs face detection and analysis, and manages face clustering.
- `docker-compose.yml`: Defines the multi-container Docker application with services for PostgreSQL, Redis, and the Flask web application.
- `db.py`: Contains the database connection and initialization logic.
- `config.py`: Configuration file for setting environment variables and application settings.

## Installation

### Prerequisites

- Docker and Docker Compose installed on your machine.

### Setup

1. Clone this repository:
    ```bash
    git clone https://github.com/michaelachmann/face-database.git
    cd face-database
    ```

2. Set the `ENVIRONMENT` variable depending on your environment:

    - For GPU-enabled systems:
        ```bash
        export ENVIRONMENT=gpu
        ```


    - For CPU-only systems (default, e.g., Mac M3):
        ```bash
        export ENVIRONMENT=cpu
        ```

3. Build and start the application using Docker Compose:
    ```bash
    docker-compose up --build
    ```

4. Access the application in your browser at `http://localhost:8080`.

## Usage

- **Upload Images**: You can upload images through the web interface by selecting a file, providing a URL, or entering a Base64 string.
- **View Persons**: View a list of detected persons and images where they appear.
- **Face Clustering**: Clustering of similar faces is performed periodically by the worker process.

## Notes

- This is a quick implementation with lots of code generated by ChatGPT.
- It is not advised to run this code in a production environment due to its experimental nature and potential security risks.

## Configuration

- The application configuration is managed via the `config.py` file. Update this file to change settings such as Redis URL, database connection details, and others.

## License

This project is licensed under the GNU General Public License v3.0. See the [LICENSE](LICENSE) file for details.

## Contributing

Contributions are welcome! Please open an issue or submit a pull request.

## Acknowledgments

- [DeepFace](https://github.com/serengil/deepface) for face detection and analysis.
- [Flask](https://flask.palletsprojects.com/) for the web framework.
- [HDBSCAN](https://hdbscan.readthedocs.io/) for the clustering algorithm.

## Contact

For any inquiries, please contact Michael Achmann-Denkler at [michael.achmann@informatik.uni-regensburg.de](mailto:michael.achmann@informatik.uni-regensburg.de).
